# Chatbot Functionality

This document describes the chatbot functionality added to the "Legend of Theseus and Minotaur" game.

## Overview

The chatbot functionality allows AI to silently take control over selected characters in the game. When a character is under AI control, their dialogue responses are generated by an AI model (by default, OpenAI's API) based on the character's attributes and the conversation context.

## Components

### Chatbot Class

The `Chatbot` class in `chatbot.py` provides the core functionality for AI-controlled characters:

- Associates a chatbot with a character
- Manages conversation history
- Activates/deactivates AI control
- Generates responses using an AI adapter

### AI Adapters

The chatbot system uses an adapter pattern to support different AI services:

- `AIAdapter`: Abstract base class defining the interface for AI adapters
- `OpenAIAdapter`: Implementation for OpenAI's API (default)
- Custom adapters can be created by implementing the `AIAdapter` interface

### AI_ASSUME_CONTROL Event

A new event type `AI_ASSUME_CONTROL` has been added to the game's event system. When this event is triggered, the specified character is silently placed under AI control.

## Usage

### In JSON Day Files

To make a character AI-controlled, add an `ai_assume_control` event to a day file:

```json
{
  "event_type": "ai_assume_control",
  "character": "CharacterName"
}
```

### Programmatically

To programmatically make a character AI-controlled:

```python
from event import Event, EventType
from character import Character

# Create an AI_ASSUME_CONTROL event
event = Event(
    event_type=EventType.AI_ASSUME_CONTROL,
    actor=character  # The character to be controlled by AI
)

# Apply the event to the group
event.apply(group)
```

## How It Works

1. When an `AI_ASSUME_CONTROL` event is applied to a group:
   - A chatbot is created for the character if one doesn't exist
   - The chatbot is activated to take control of the character

2. When dialogue occurs in the game:
   - All active chatbots record the dialogue in their conversation history
   - If a character with an active chatbot is addressed, the chatbot generates a response
   - The generated response is applied as a new dialogue line from the character

3. The chatbot generates responses based on:
   - The character's attributes (leadership, intelligence, resilience)
   - The character's current emotion
   - The character's relationships (friends/enemies)
   - The conversation history

## Configuration

The OpenAI adapter requires an API key, which can be provided in two ways:

1. Set the `OPENAI_API_KEY` environment variable
2. Pass the API key directly when creating the adapter:

```python
from chatbot import Chatbot, OpenAIAdapter

adapter = OpenAIAdapter(api_key="your-api-key")
chatbot = Chatbot(character, adapter=adapter)
```

## Customization

### Custom AI Adapters

To create a custom AI adapter, implement the `AIAdapter` interface:

```python
from chatbot import AIAdapter

class CustomAdapter(AIAdapter):
    def generate_response(self, character, context, prompt=None):
        # Custom implementation to generate a response
        return "Generated response"
```

### Prompt Customization

When generating a response, you can provide an optional prompt to guide the AI:

```python
response = chatbot.generate_response(prompt="Make the response more sarcastic")
```